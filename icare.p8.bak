pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--icare project
--work in progress

--never repeat button presses
poke(0x5f5c, 255)

function _update()
 currentscreen:update()
end

function _draw()
 currentscreen:draw()
end

--vector lib
vec = {x=0,y=0}
function vec:new(a,b)
 local n = {x=a or 0,y=b or 0}
 self.__index = self
 return setmetatable(n,self)
end
function vec:set(a,b)
 self.x=a
 self.y=b
end
function vec:__add(r)
 return vec:new(self.x+r.x,self.y+r.y)
end
function vec:__sub(r)
 return vec:new(self.x-r.x,self.y-r.y)
end
function vec:__mul(r)
 return vec:new(self.x*r,self.y*r)
end
function vec:__div(r)
 return vec:new(self.x/r,self.y/r)
end
function vec:__eq(r)
	return self.x == r.x and self.y == r.y
end
function vec:slen()
 return self.x*self.x+self.y*self.y
end
function vec:__len()
 return sqrt(self:slen())
end
function vec:unit()
 return self / #self
end
function vec:norm()
 local len = #self
 self.x /= len
 self.y /= len
end
--dot product
function vec:__pow(r)
 return self.x*r.x + self.y*r.y
end

--starfield
stf = {}
stf[0] = {}
stf[0].col = 1
stf[0].spd = 1
stf[0].amt = 20
stf[1] = {}
stf[1].col = 5
stf[1].spd = 2
stf[1].amt = 10
stf[2] = {}
stf[2].col = 7
stf[2].spd = 6
stf[2].amt = 3

for l=0,2 do
 for i=0,stf[l].amt-1 do
  stf[l][i] = {}
  stf[l][i] = vec:new(rnd(128),rnd(128))
 end
end

function stf.update()
 for l=0,2 do
  for i=0,stf[l].amt-1 do
   stf[l][i].y += stf[l].spd
   if stf[l][i].y>128 then
    stf[l][i].x = rnd(128)
    stf[l][i].y = -rnd(128/stf[l].amt)
   end
  end
 end
end

function stf.draw(depth)
 for l=0,(depth or 2) do
  local c = stf[l].col
  for i=0,stf[l].amt-1 do
   local s = stf[l][i]
   pset(s.x,s.y,c)
  end
 end
end
-->8
scrollscreen = {
text = [[
  bonjour ceci
  est un texte
   qui va me
  servir a test
  le defilement
   au style de
   star-wars.
  j'espere que
   cela vous
  plait. vous
  avez interet
   d'aprecier
    sinon je
   viens chez
   vous et je
    corrige
  cette erreur
  de la maniere
    la plus
    terrible
   qu'il soit.

  bonne journee
]]
,
scroll = 0
}

function scrollscreen:update()
 self.scroll += 0.02
 if btnp(❎) then
  currentscreen = titlescreen
 end
end
function scrollscreen:draw()
 cls()
 print (self.text,1,0,1)
 print (self.text,0,0,7)
 ----[[
 for i=0,63 do
  memcpy(0x1000+i*64,0x6000+i*64,32)
 end
 for i=64,127 do
  memcpy(0x1000+32+(i-64)*64,0x6000+i*64,32)
 end
 --]]
 cls()
 for j=0,7 do
  for i=0,7 do
   mset(i,j,128+j*16+i)
  end
 end
 for j=0,7 do
  for i=0,7 do
   mset(i,j+8,128+j*16+i+8)
  end
 end

 --map(0,0,32,32,8,32)
 stf.draw(0)

 ---[[
 for i=0,111 do
  local my = 2-256/i+self.scroll
  local s = 1
  if my > 0 then
   tline(
    32-s*i,16+i,
    96+s*2*i,16+i,
    0,my,
    8/(64+s*2*i))
  end
 end
 --]]
end

currentscreen = scrollscreen
-->8
titlescreen = {
blink = 0
}

function titlescreen:update()
 self.blink += 1
 if (self.blink>30) self.blink=0
 if btnp(❎) then
  currentscreen = gamescreen
 end
end

function titlescreen:draw()
 cls()
 if (self.blink> 15) then
  print("press ❎ to play",32,60)
 end
end
-->8
gamescreen = {
}

--bullets
bullet = {
nextbullet = nil,
}
bullet.lastbullet = bullet

function bullet.create(a,b)
 local n = {x=a,y=b,c=8,nextbullet=nil}
 bullet.lastbullet.nextbullet = n
 bullet.lastbullet = n
end

function bullet.update()
 local pb = bullet
 local b = bullet.nextbullet
 while b do
  b.y -= 5
  if b.y < 0 then
   pb.nextbullet = b.nextbullet
  else
   b.c += 1
   if (b.c>10) b.c=8
   pb = b
  end  
  b = b.nextbullet
 end
 bullet.lastbullet = pb
end

function bullet.draw()
 local b = bullet.nextbullet
 while b do
  line(b.x,b.y,b.x,b.y-5,b.c)
  b = b.nextbullet
 end
end

--ship
ship = vec:new(60,100)
shipspd = vec:new()
laserleft = 0

--update and draw
function gamescreen:update()
 stf.update()
	bullet.update()
 --move
 local spdtgt = vec:new()
 if (btn(⬅️)) spdtgt.x -=3
 if (btn(➡️)) spdtgt.x +=3
 if (btn(⬆️)) spdtgt.y -=3
 if (btn(⬇️)) spdtgt.y +=3
 
 local stt = spdtgt - shipspd
 local sttl = #stt
 if sttl > 0.3 then
  shipspd += stt * 0.6 / sttl
 elseif spdtgt:slen() == 0 then
  shipspd:set(0,0)
 end
 ship += shipspd
 
 --shoot
 if btnp(❎) then
  sfx(0)
  bullet.create(
   ship.x-laserleft%2,
   ship.y-3)
  laserleft += 1
 end
end

function gamescreen:draw()
 cls()
 stf.draw()
 bullet.draw()
 spr(1,ship.x-4,ship.y-4)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700002cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000012dd2100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000115005110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700100000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
1111111100000000000000000000000000000000000000000000000011111111aaaaaaaa000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000aaaaaaaa
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
8888888800000000000000000000000000000000000000000000000088888888bbbbbbbb000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000008888888800000000000000000000000000000000000000000000000000000000bbbbbbbb
__map__
0101000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100003b1503a150391503615033150301502c15029150241501f1501a15013100121000f1500e100011000a100061500710005100021000300000000011500e0000b000070000200002100222000000000000
