pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- line()-compatible fill test
-- by cake>pie

posa={32,32}
posb={96,96}
displace=2 edge=120
cumerr=false
roundup=true
menuitem(1,"round 0.5 up",function() cumerr=false roundup=true end)
menuitem(2,"round 0.5 down",function() cumerr=false roundup=false end)
menuitem(3,"cumulative err",function() cumerr=true end)
menuitem(4,"example case a",function() posa={32,32} posb={94,93} end)
menuitem(5,"example case b",function() posa={32,32} posb={96,95} end)
function _update()
 if(btn(0)) posb[1]-=0.25
 if(btn(1)) posb[1]+=0.25
 if(btn(2)) posb[2]-=0.25
 if(btn(3)) posb[2]+=0.25
 if(btn(0,1)) posa[1]-=0.25
 if(btn(1,1)) posa[1]+=0.25
 if(btn(2,1)) posa[2]-=0.25
 if(btn(3,1)) posa[2]+=0.25
 if(btnp(5)) updown()
 if(btnp(4)) posa={4+rnd(56),4+rnd{112}} posb={68+rnd(56),4+rnd(112)}
end
function _draw()
 cls(8) rectfill(1,1,126,120,0)
 linefill(posa[1],posa[2],posb[1],posb[2],8)
 linefill(posa[1],posa[2]+displace,posb[1],posb[2]+displace,5)
 line(posa[1],posa[2],posb[1],posb[2],7)
 print(posa[1]..","..posa[2].." - "..posb[1]..","..posb[2],1,122,7)
end
function linefill(x1,y1,x2,y2,c)
 x1=flr(x1) y1=flr(y1)
 x2=flr(x2) y2=flr(y2)
 if cumerr then
  local y=y1
  local m=(y2-y1)/(x2-x1)
  local e=0
  for x=x1,x2 do
   rectfill(x,y,x,edge,c)
   e+=m
   if(e>0.5) e-=1 y+=1
  end  
 else
  for x=x1,x2 do
   local y=y1+(y2-y1)*(x-x1)/(x2-x1)
   local frac=y%1
   if roundup then
    if(frac>=0.5) y=flr(y+0.5)
   else
    if(frac>0.5) y=flr(y+0.5)
   end
   rectfill(x,y,x,edge,c)
  end
 end
end

function updown()
 if displace>0 then displace=-2 edge=1
 else displace=2 edge=120 end
end
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000870000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000587000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000558700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555870000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555587000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555558700000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555870000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555587000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555558700000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555870000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555587000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555558700000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555870000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555587000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555558700000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555870000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555587000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555558700000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555870000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555587000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555558700000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555870000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555587000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555558700000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555870000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555587000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555558700000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555870000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555587000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555558700000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555870000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555587000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555558700000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555870000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555587000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555558700000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555870000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555587000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555558700000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555870000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555587000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555558700000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555870000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555587000000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555558700000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555870000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555587000000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555558700000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555870000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555587000000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555558700000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555870000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555587000000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555558700000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555870000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555587000000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555558700000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555870000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555587000000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555558700000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555870000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555587000000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555558700000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555870000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555580000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
80000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000008
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
87778777888887778777888888888888877787888888877787888888888888888888888888888888888888888888888888888888888888888888888888888888
88878887888888878887888888888888878787888888878787888888888888888888888888888888888888888888888888888888888888888888888888888888
88778777888888778777888887778888877787778888877787778888888888888888888888888888888888888888888888888888888888888888888888888888
88878788887888878788888888888888888787878878888787878888888888888888888888888888888888888888888888888888888888888888888888888888
87778777878887778777888888888888888787778788888787778888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

